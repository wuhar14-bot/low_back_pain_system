<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Low Back Pain System Integration Plan - ABP vNext 7.3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px;
            text-align: center;
        }

        header h1 {
            font-size: 2.8em;
            margin-bottom: 15px;
        }

        header .subtitle {
            font-size: 1.4em;
            opacity: 0.95;
        }

        header .tech-stack {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        header .tech-item {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .summary {
            background: #f8f9fa;
            padding: 40px;
            border-bottom: 3px solid #667eea;
        }

        .summary h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .architecture-diagram {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .architecture-diagram pre {
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            line-height: 1.4;
            color: #333;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 60px;
            border-left: 5px solid #667eea;
            padding-left: 30px;
        }

        .section h2 {
            color: #333;
            font-size: 2.2em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            font-weight: bold;
        }

        .section h3 {
            color: #667eea;
            font-size: 1.6em;
            margin: 30px 0 15px 0;
        }

        .section h4 {
            color: #555;
            font-size: 1.3em;
            margin: 20px 0 10px 0;
        }

        .code-block {
            background: #f5f5f5;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .code-block pre {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .code-block code {
            color: #333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .alert {
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border-left: 5px solid;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .feature-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .feature-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .feature-card ul {
            list-style: none;
            padding-left: 0;
        }

        .feature-card li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }

        .feature-card li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
        }

        .timeline {
            position: relative;
            padding-left: 40px;
        }

        .timeline:before {
            content: "";
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .timeline-item:before {
            content: "";
            position: absolute;
            left: -33px;
            top: 25px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
        }

        .timeline-item h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .timeline-item ul {
            list-style: none;
            padding-left: 20px;
        }

        .timeline-item li {
            padding: 5px 0;
        }

        .timeline-item li:before {
            content: "â–¡";
            margin-right: 10px;
            color: #999;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .comparison-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .comparison-card h4 {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .comparison-card.source {
            border-top: 4px solid #17a2b8;
        }

        .comparison-card.source h4 {
            background: #d1ecf1;
            color: #0c5460;
        }

        .comparison-card.target {
            border-top: 4px solid #28a745;
        }

        .comparison-card.target h4 {
            background: #d4edda;
            color: #155724;
        }

        .comparison-card ul {
            list-style: none;
            padding: 0;
        }

        .comparison-card li {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            color: #666;
            border-top: 3px solid #667eea;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
        }

        @media (max-width: 768px) {
            .comparison-grid {
                grid-template-columns: 1fr;
            }

            header h1 {
                font-size: 2em;
            }

            header .tech-stack {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¥ Low Back Pain System</h1>
            <p class="subtitle">Integration Plan for ABP vNext 7.3 System</p>
            <div class="tech-stack">
                <div class="tech-item">ğŸ“¦ .NET 7.0 + ABP Framework v7.3</div>
                <div class="tech-item">ğŸ—„ï¸ PostgreSQL Database</div>
                <div class="tech-item">ğŸ¨ Vue.js + Element UI</div>
                <div class="tech-item">âš›ï¸ React + Vite + shadcn/ui</div>
                <div class="tech-item">ğŸ Python Flask Microservices</div>
            </div>
        </header>

        <div class="summary">
            <h2>ğŸ“‹ Executive Summary</h2>
            <p style="font-size: 1.1em; margin-bottom: 20px;">
                æœ¬æ–‡æ¡£æä¾›å°†ä½è…°ç—›æ•°æ®æ”¶é›†ç³»ç»Ÿé›†æˆåˆ°ç°æœ‰ ABP vNext 7.3 ç³»ç»Ÿçš„è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆã€‚
                é›†æˆç­–ç•¥é‡‡ç”¨æ¨¡å—åŒ–æ–¹æ³•ï¼Œä¿ç•™ç°æœ‰ Python AI æœåŠ¡ï¼Œå‡å°‘å¼€å‘æˆæœ¬å’Œé£é™©ã€‚
            </p>

            <div class="comparison-grid">
                <div class="comparison-card source">
                    <h4>ğŸ“¤ Source System (Low Back Pain)</h4>
                    <ul>
                        <li><strong>Backend:</strong> Python Flask (3 microservices)</li>
                        <li><strong>Database:</strong> SQLite 3</li>
                        <li><strong>Frontend:</strong> React + Vite + shadcn/ui</li>
                        <li><strong>AI Services:</strong> OCR (PaddleOCR), Pose Analysis (MediaPipe)</li>
                        <li><strong>Data:</strong> 70+ fields, 7 sections, JSON-heavy</li>
                    </ul>
                </div>

                <div class="comparison-card target">
                    <h4>ğŸ“¥ Target System (ABP vNext)</h4>
                    <ul>
                        <li><strong>Backend:</strong> .NET 7.0 + ABP Framework v7.3</li>
                        <li><strong>Database:</strong> PostgreSQL</li>
                        <li><strong>Frontend:</strong> Vue.js + Element UI</li>
                        <li><strong>Authentication:</strong> âœ… Existing login system</li>
                        <li><strong>Workspaces:</strong> âœ… Existing studio/tenant system</li>
                    </ul>
                </div>
            </div>

            <div class="alert alert-info">
                <strong>ğŸ¯ Integration Goal:</strong> å°†ä½è…°ç—›ç³»ç»Ÿä½œä¸º ABP æ¨¡å—é›†æˆï¼Œå¤ç”¨ç°æœ‰ç™»å½•å’Œå·¥ä½œå®¤ç³»ç»Ÿï¼Œä¿ç•™ Python AI æœåŠ¡ç‹¬ç«‹è¿è¡Œã€‚
            </div>
        </div>

        <div class="content">
            <!-- Section 1: Architecture -->
            <div class="section">
                <h2><span class="section-number">1</span> Integration Architecture</h2>

                <div class="alert alert-success">
                    <strong>âœ… Key Decision:</strong> é‡‡ç”¨ <strong>Modular Integration</strong> æ–¹æ¡ˆ
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>å°† Low Back Pain System ä½œä¸º ABP æ¨¡å—å¼€å‘</li>
                        <li>å‰ç«¯ React ç»„ä»¶é€šè¿‡ Web Components æˆ– iframe åµŒå…¥ Vue åº”ç”¨</li>
                        <li>Python å¾®æœåŠ¡ä¿æŒç‹¬ç«‹ï¼Œé€šè¿‡ HTTP API è°ƒç”¨</li>
                        <li>å¤ç”¨ç°æœ‰ ABP ç™»å½•å’Œå·¥ä½œå®¤ç³»ç»Ÿ</li>
                    </ul>
                </div>

                <div class="architecture-diagram">
                    <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ABP vNext System                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Vue.js Frontend + Element UI                â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Low Back Pain Module (React Components)       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - åµŒå…¥ä¸º Web Component æˆ– iframe              â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           ABP Backend (.NET 7.0)                     â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  LowBackPain.Application Module              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - PatientAppService                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Use existing AbpUsers & Tenants           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  LowBackPain.Domain Module                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - PatientRecord Entity                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Repositories                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  LowBackPain.EntityFrameworkCore             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - EF Core DbContext (PostgreSQL)            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               PostgreSQL Database                     â”‚  â”‚
â”‚  â”‚  - PatientRecords Table (JSONB columns)              â”‚  â”‚
â”‚  â”‚  - ABP standard tables (Users, Tenants, etc.)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Python Microservices (ç‹¬ç«‹è¿è¡Œ):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OCR Service  â”‚  â”‚ Pose Service â”‚  â”‚ LLM Service  â”‚
â”‚   :5001      â”‚  â”‚   :5002      â”‚  â”‚   :5004      â”‚
â”‚ PaddleOCR    â”‚  â”‚  MediaPipe   â”‚  â”‚  GPT/Claude  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    </pre>
                </div>
            </div>

            <!-- Section 2: Database Migration -->
            <div class="section">
                <h2><span class="section-number">2</span> Database Migration</h2>

                <h3>2.1 SQLite â†’ PostgreSQL Schema</h3>

                <div class="alert alert-warning">
                    <strong>âš ï¸ Important:</strong> ç°æœ‰ç³»ç»Ÿå·²æœ‰ç™»å½•å’Œå·¥ä½œå®¤ç®¡ç†ï¼Œæ— éœ€åˆ›å»ºæ–°çš„ Workspace entityã€‚
                    PatientRecord ç›´æ¥ä½¿ç”¨ ABP çš„ <code>TenantId</code> å­—æ®µå…³è”åˆ°ç°æœ‰å·¥ä½œå®¤ã€‚
                </div>

                <h4>PatientRecord Entity</h4>

                <table>
                    <thead>
                        <tr>
                            <th>Field Category</th>
                            <th>Fields</th>
                            <th>PostgreSQL Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ABP Standard</strong></td>
                            <td>
                                Id, TenantId<br>
                                CreationTime, CreatorId<br>
                                LastModificationTime, LastModifierId<br>
                                IsDeleted, DeletionTime, DeleterId
                            </td>
                            <td>
                                UUID, UUID<br>
                                TIMESTAMP, UUID<br>
                                TIMESTAMP, UUID<br>
                                BOOLEAN, TIMESTAMP, UUID
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Basic Info (Required)</strong></td>
                            <td>StudyId, Gender, Age</td>
                            <td>VARCHAR(100), VARCHAR(10), INTEGER</td>
                        </tr>
                        <tr>
                            <td><strong>Basic Info (Optional)</strong></td>
                            <td>Name, Phone</td>
                            <td>VARCHAR(200), VARCHAR(50)</td>
                        </tr>
                        <tr>
                            <td><strong>Medical History</strong></td>
                            <td>
                                OnsetDate<br>
                                ChiefComplaint<br>
                                MedicalHistory<br>
                                PainAreas
                            </td>
                            <td>
                                DATE<br>
                                TEXT<br>
                                JSONB<br>
                                JSONB
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Clinical Examination</strong></td>
                            <td>
                                SubjectiveExam<br>
                                ObjectiveExam<br>
                                FunctionalScores<br>
                                Intervention
                            </td>
                            <td>
                                JSONB<br>
                                JSONB<br>
                                JSONB<br>
                                JSONB
                            </td>
                        </tr>
                        <tr>
                            <td><strong>AI Analysis</strong></td>
                            <td>AiPostureAnalysis</td>
                            <td>JSONB</td>
                        </tr>
                        <tr>
                            <td><strong>Metadata</strong></td>
                            <td>Remarks, LastSyncTimestamp, DataJson</td>
                            <td>TEXT, TIMESTAMP, JSONB</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Key Indexes</h4>
                <div class="code-block">
                    <pre><code>CREATE INDEX "IX_PatientRecords_StudyId" ON "PatientRecords"("StudyId");
CREATE INDEX "IX_PatientRecords_CreationTime" ON "PatientRecords"("CreationTime");
CREATE INDEX "IX_PatientRecords_TenantId" ON "PatientRecords"("TenantId");
CREATE INDEX "IX_PatientRecords_IsDeleted" ON "PatientRecords"("IsDeleted");

-- JSONB Indexes for fast queries
CREATE INDEX "IX_PatientRecords_SubjectiveExam_PainScore"
    ON "PatientRecords" USING GIN (("SubjectiveExam"->'pain_score'));

CREATE INDEX "IX_PatientRecords_PainAreas"
    ON "PatientRecords" USING GIN ("PainAreas");</code></pre>
                </div>

                <h3>2.2 Data Migration Strategy</h3>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ” Pre-Migration</h4>
                        <ul>
                            <li>Backup SQLite database</li>
                            <li>Export to CSV for verification</li>
                            <li>Test migration on staging</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>ğŸ”„ Migration Process</h4>
                        <ul>
                            <li>Python script: SQLite â†’ PostgreSQL</li>
                            <li>Convert JSON strings to JSONB</li>
                            <li>Generate new UUIDs for Id field</li>
                            <li>Map to ABP audit fields</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>âœ… Post-Migration</h4>
                        <ul>
                            <li>Verify record counts match</li>
                            <li>Validate JSON data integrity</li>
                            <li>Test queries and indexes</li>
                            <li>Performance benchmarking</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Section 3: Backend Integration -->
            <div class="section">
                <h2><span class="section-number">3</span> Backend Integration (.NET)</h2>

                <h3>3.1 ABP Module Structure</h3>

                <div class="code-block">
                    <pre><code>LowBackPain/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ LowBackPain.Domain/
â”‚   â”‚   â”œâ”€â”€ Entities/PatientRecord.cs
â”‚   â”‚   â””â”€â”€ Repositories/IPatientRecordRepository.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ LowBackPain.Application.Contracts/
â”‚   â”‚   â””â”€â”€ Patients/
â”‚   â”‚       â”œâ”€â”€ IPatientAppService.cs
â”‚   â”‚       â”œâ”€â”€ PatientDto.cs
â”‚   â”‚       â””â”€â”€ CreatePatientDto.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ LowBackPain.Application/
â”‚   â”‚   â””â”€â”€ Patients/PatientAppService.cs
â”‚   â”‚
â”‚   â”œâ”€â”€ LowBackPain.EntityFrameworkCore/
â”‚   â”‚   â””â”€â”€ EntityFrameworkCore/LowBackPainDbContext.cs
â”‚   â”‚
â”‚   â””â”€â”€ LowBackPain.HttpApi/
â”‚       â””â”€â”€ Controllers/PatientController.cs</code></pre>
                </div>

                <h3>3.2 Key API Endpoints</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Method</th>
                            <th>Endpoint</th>
                            <th>Description</th>
                            <th>Auth</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td>/api/low-back-pain/patients</td>
                            <td>Get patient list (paginated)</td>
                            <td><span class="badge badge-warning">Required</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td>/api/low-back-pain/patients/{id}</td>
                            <td>Get patient by ID</td>
                            <td><span class="badge badge-warning">Required</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-success">POST</span></td>
                            <td>/api/low-back-pain/patients</td>
                            <td>Create new patient</td>
                            <td><span class="badge badge-danger">Permission</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-warning">PUT</span></td>
                            <td>/api/low-back-pain/patients/{id}</td>
                            <td>Update patient</td>
                            <td><span class="badge badge-danger">Permission</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-danger">DELETE</span></td>
                            <td>/api/low-back-pain/patients/{id}</td>
                            <td>Delete patient (soft delete)</td>
                            <td><span class="badge badge-danger">Permission</span></td>
                        </tr>
                        <tr>
                            <td><span class="badge badge-info">GET</span></td>
                            <td>/api/low-back-pain/patients/by-study-id/{studyId}</td>
                            <td>Get patient by study ID</td>
                            <td><span class="badge badge-warning">Required</span></td>
                        </tr>
                    </tbody>
                </table>

                <h3>3.3 Authentication Integration</h3>

                <div class="alert alert-success">
                    <strong>âœ… ä½¿ç”¨ç°æœ‰ ABP è®¤è¯ç³»ç»Ÿ:</strong>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>å¤ç”¨ç°æœ‰ JWT Token è®¤è¯</li>
                        <li>ä½¿ç”¨ç°æœ‰ AbpUsers è¡¨</li>
                        <li>ä½¿ç”¨ç°æœ‰ Tenants/Studios è¡¨ (é€šè¿‡ TenantId å…³è”)</li>
                        <li>å¤ç”¨ç°æœ‰æƒé™ç³»ç»Ÿ</li>
                    </ul>
                </div>
            </div>

            <!-- Section 4: Frontend Integration -->
            <div class="section">
                <h2><span class="section-number">4</span> Frontend Integration</h2>

                <h3>4.1 Integration Options</h3>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸŒ Option 1: Web Components (æ¨è)</h4>
                        <ul>
                            <li>React åº”ç”¨æ‰“åŒ…ä¸º Web Component</li>
                            <li>æ ‡å‡†åŒ– APIï¼Œè·¨æ¡†æ¶å…¼å®¹</li>
                            <li>æ ·å¼éš”ç¦» (Shadow DOM)</li>
                            <li>Easy communication via props</li>
                            <li><strong>Build size:</strong> ~500KB gzipped</li>
                        </ul>
                        <span class="badge badge-success">Recommended</span>
                    </div>

                    <div class="feature-card">
                        <h4>ğŸ“º Option 2: iframe Embedding</h4>
                        <ul>
                            <li>å®Œå…¨éš”ç¦»çš„ React åº”ç”¨</li>
                            <li>ç‹¬ç«‹çš„ HTML é¡µé¢</li>
                            <li>PostMessage API é€šä¿¡</li>
                            <li>ç®€å•ä½†æ€§èƒ½ç•¥å·®</li>
                            <li><strong>Setup time:</strong> Fast</li>
                        </ul>
                        <span class="badge badge-info">Alternative</span>
                    </div>

                    <div class="feature-card">
                        <h4>ğŸ”„ Option 3: Full Rewrite</h4>
                        <ul>
                            <li>ç”¨ Vue + Element UI é‡å†™</li>
                            <li>å®Œå…¨åŸç”Ÿé›†æˆ</li>
                            <li>æœ€ä½³æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ</li>
                            <li>ä½†å¼€å‘æˆæœ¬é«˜</li>
                            <li><strong>Dev time:</strong> 4-6 weeks</li>
                        </ul>
                        <span class="badge badge-warning">High Cost</span>
                    </div>
                </div>

                <h3>4.2 Web Component Implementation</h3>

                <div class="code-block">
                    <pre><code>// React App - Build as Web Component
class LowBackPainWidget extends HTMLElement {
  connectedCallback() {
    const mountPoint = document.createElement('div');
    this.attachShadow({ mode: 'open' }).appendChild(mountPoint);

    ReactDOM.render(
      &lt;PatientForm
        apiEndpoint={this.getAttribute('api-endpoint')}
        authToken={this.getAttribute('auth-token')}
      /&gt;,
      mountPoint
    );
  }
}

customElements.define('low-back-pain-widget', LowBackPainWidget);</code></pre>
                </div>

                <div class="code-block">
                    <pre><code>&lt;!-- Vue Application Usage --&gt;
&lt;template&gt;
  &lt;el-card&gt;
    &lt;low-back-pain-widget
      :api-endpoint="apiEndpoint"
      :auth-token="authToken"
    /&gt;
  &lt;/el-card&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      apiEndpoint: '/api/low-back-pain/patients',
      authToken: this.$store.state.auth.token
    };
  }
};
&lt;/script&gt;</code></pre>
                </div>
            </div>

            <!-- Section 5: Python Microservices -->
            <div class="section">
                <h2><span class="section-number">5</span> Python Microservices Integration</h2>

                <h3>5.1 Service Architecture</h3>

                <table>
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Port</th>
                            <th>Technology</th>
                            <th>Function</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>OCR Service</strong></td>
                            <td>5001</td>
                            <td>Flask + PaddleOCR</td>
                            <td>åŒ»ç–—è¡¨å•æ–‡å­—è¯†åˆ«</td>
                        </tr>
                        <tr>
                            <td><strong>Pose Analysis</strong></td>
                            <td>5002</td>
                            <td>Flask + MediaPipe</td>
                            <td>å§¿æ€åˆ†æã€ROMæµ‹é‡</td>
                        </tr>
                        <tr>
                            <td><strong>LLM Service</strong></td>
                            <td>5004</td>
                            <td>Flask + GPT API</td>
                            <td>æ™ºèƒ½æ•°æ®æå–</td>
                        </tr>
                    </tbody>
                </table>

                <h3>5.2 HTTP Proxy Implementation</h3>

                <div class="code-block">
                    <pre><code>// .NET Backend - OcrProxyService.cs
public class OcrProxyService : ITransientDependency
{
    private readonly HttpClient _httpClient;
    private readonly IConfiguration _configuration;

    public async Task&lt;OcrResultDto&gt; ProcessImageAsync(IFormFile imageFile)
    {
        var ocrServiceUrl = _configuration["PythonServices:OcrUrl"];

        using var content = new MultipartFormDataContent();
        using var fileContent = new StreamContent(imageFile.OpenReadStream());
        content.Add(fileContent, "image", imageFile.FileName);

        var response = await _httpClient.PostAsync(
            $"{ocrServiceUrl}/ocr/process",
            content
        );

        response.EnsureSuccessStatusCode();
        var result = await response.Content.ReadAsStringAsync();

        return JsonSerializer.Deserialize&lt;OcrResultDto&gt;(result);
    }
}</code></pre>
                </div>

                <div class="alert alert-info">
                    <strong>ğŸ’¡ Deployment Strategy:</strong> Python æœåŠ¡å¯ä»¥ç‹¬ç«‹éƒ¨ç½²ä¸º Docker å®¹å™¨ï¼Œ
                    é€šè¿‡å†…éƒ¨ç½‘ç»œä¸ .NET Backend é€šä¿¡ã€‚æ”¯æŒç‹¬ç«‹æ‰©å±•å’Œæ›´æ–°ã€‚
                </div>
            </div>

            <!-- Section 6: Deployment -->
            <div class="section">
                <h2><span class="section-number">6</span> Deployment Strategy</h2>

                <h3>6.1 Docker Compose Architecture</h3>

                <div class="code-block">
                    <pre><code>version: '3.8'

services:
  abp-backend:
    image: abp-backend:latest
    ports:
      - "5000:80"
    environment:
      - ConnectionStrings__Default=Host=postgres;Database=abp_db
      - PythonServices__OcrUrl=http://ocr-service:5001
      - PythonServices__PoseUrl=http://pose-service:5002
    depends_on:
      - postgres
      - ocr-service
      - pose-service

  ocr-service:
    image: low-back-pain-ocr:latest
    ports:
      - "5001:5001"

  pose-service:
    image: low-back-pain-pose:latest
    ports:
      - "5002:5002"

  postgres:
    image: postgres:14
    environment:
      - POSTGRES_DB=abp_db
      - POSTGRES_PASSWORD=your_password
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data:</code></pre>
                </div>

                <h3>6.2 Production Nginx Configuration</h3>

                <div class="code-block">
                    <pre><code>server {
    listen 80;
    server_name app.example.com;

    # Vue Frontend
    location / {
        root /var/www/vue-app;
        try_files $uri $uri/ /index.html;
    }

    # ABP Backend API
    location /api/ {
        proxy_pass http://localhost:5000/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # React Module Static Files
    location /modules/low-back-pain/ {
        root /var/www/;
        try_files $uri $uri/ =404;
    }

    # OCR Service
    location /ocr/ {
        proxy_pass http://localhost:5001/;
    }

    # Pose Service
    location /pose/ {
        proxy_pass http://localhost:5002/;
    }
}</code></pre>
                </div>
            </div>

            <!-- Section 7: Timeline -->
            <div class="section">
                <h2><span class="section-number">7</span> Implementation Timeline</h2>

                <div class="timeline">
                    <div class="timeline-item">
                        <h4>ğŸ“… Phase 1: Database & Backend (Week 1-2)</h4>
                        <ul>
                            <li>Design PostgreSQL schema</li>
                            <li>Create ABP domain entities</li>
                            <li>Implement repositories</li>
                            <li>Create application services</li>
                            <li>Write unit tests</li>
                            <li>Migrate SQLite data to PostgreSQL</li>
                        </ul>
                        <span class="badge badge-info">2 weeks</span>
                    </div>

                    <div class="timeline-item">
                        <h4>ğŸ“… Phase 2: API Integration (Week 3)</h4>
                        <ul>
                            <li>Implement HTTP controllers</li>
                            <li>Integrate existing authentication</li>
                            <li>Create Python service proxies</li>
                            <li>Test API endpoints</li>
                            <li>API documentation (Swagger)</li>
                        </ul>
                        <span class="badge badge-info">1 week</span>
                    </div>

                    <div class="timeline-item">
                        <h4>ğŸ“… Phase 3: Frontend Integration (Week 4-5)</h4>
                        <ul>
                            <li>Build React app as Web Component</li>
                            <li>Integrate into Vue application</li>
                            <li>Implement authentication flow</li>
                            <li>Test cross-component communication</li>
                            <li>UI/UX testing</li>
                        </ul>
                        <span class="badge badge-info">2 weeks</span>
                    </div>

                    <div class="timeline-item">
                        <h4>ğŸ“… Phase 4: Deployment (Week 6)</h4>
                        <ul>
                            <li>Docker containerization</li>
                            <li>Nginx reverse proxy configuration</li>
                            <li>Production environment setup</li>
                            <li>Load testing</li>
                            <li>Security audit</li>
                        </ul>
                        <span class="badge badge-info">1 week</span>
                    </div>

                    <div class="timeline-item">
                        <h4>ğŸ“… Phase 5: Documentation & Training (Week 7)</h4>
                        <ul>
                            <li>API documentation</li>
                            <li>User manual</li>
                            <li>Admin guide</li>
                            <li>Developer documentation</li>
                            <li>Team training sessions</li>
                        </ul>
                        <span class="badge badge-success">1 week</span>
                    </div>
                </div>

                <div class="alert alert-success" style="margin-top: 30px;">
                    <strong>ğŸ¯ Total Timeline:</strong> 7 weeks (approximately 2 months)
                </div>
            </div>

            <!-- Section 8: Risk Assessment -->
            <div class="section">
                <h2><span class="section-number">8</span> Risk Assessment</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Risk</th>
                            <th>Impact</th>
                            <th>Probability</th>
                            <th>Mitigation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Data loss during migration</td>
                            <td><span class="badge badge-danger">High</span></td>
                            <td><span class="badge badge-success">Low</span></td>
                            <td>Backup SQLite DB, test migration on staging first</td>
                        </tr>
                        <tr>
                            <td>Performance degradation</td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td>Add database indexes, optimize JSON queries</td>
                        </tr>
                        <tr>
                            <td>Authentication conflicts</td>
                            <td><span class="badge badge-danger">High</span></td>
                            <td><span class="badge badge-success">Low</span></td>
                            <td>Use existing ABP JWT, thorough testing</td>
                        </tr>
                        <tr>
                            <td>Python service downtime</td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td>Implement retry logic, health checks</td>
                        </tr>
                        <tr>
                            <td>Cross-origin issues</td>
                            <td><span class="badge badge-success">Low</span></td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td>Proper CORS configuration</td>
                        </tr>
                        <tr>
                            <td>Frontend compatibility</td>
                            <td><span class="badge badge-warning">Medium</span></td>
                            <td><span class="badge badge-success">Low</span></td>
                            <td>Polyfills, browser testing</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Section 9: Success Criteria -->
            <div class="section">
                <h2><span class="section-number">9</span> Success Criteria</h2>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>âœ… Data Migration</h4>
                        <ul>
                            <li>All patient data migrated successfully</li>
                            <li>Zero data loss</li>
                            <li>JSON data integrity validated</li>
                            <li>All relationships preserved</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>âœ… Backend Performance</h4>
                        <ul>
                            <li>API response time < 200ms</li>
                            <li>Unit test coverage > 80%</li>
                            <li>All integration tests pass</li>
                            <li>Database queries optimized</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>âœ… Frontend Integration</h4>
                        <ul>
                            <li>React components render correctly</li>
                            <li>Authentication works seamlessly</li>
                            <li>Cross-component communication functional</li>
                            <li>UI/UX matches design</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <h4>âœ… Production Ready</h4>
                        <ul>
                            <li>Docker deployment successful</li>
                            <li>Security audit passed</li>
                            <li>Load testing completed</li>
                            <li>User acceptance testing passed</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Low Back Pain System Integration Plan</strong></p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                Document Prepared by: Hao Wu<br>
                Date: 2025-10-24<br>
                Version: 1.0
            </p>
            <p style="margin-top: 15px; font-size: 0.85em; color: #999;">
                University of Hong Kong - Department of Orthopaedics & Traumatology
            </p>
        </footer>
    </div>
</body>
</html>
